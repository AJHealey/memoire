{% extends "analyse/wifi.html" %}
{% load staticfiles %}

{% block section %}
<div class="container" style='margin-top: 25px;'>
<form method="post"  action="{% url 'wifiAP' %}" class="form-horizontal" role="form">
{% csrf_token %}
	<div class="form-group">
		<label for="selectedAP" class="col-md-2 control-label">Access Point</label>
		<div class="col-md-6">			
			<select class="form-control" name="selectedAP" id="selectedAP">
				<option value="" selected></option>
				{% if allAP %}
				{% for ap in allAP %}
				<option value="{{ap.id}}">{{ap.name}}</option>
				{% endfor %}
				{% endif %}
			</select>
		</div>
		<button type="submit" class="btn btn-default">
			<span class="glyphicon glyphicon-signal"></span> Get
		</button>
	</div>
</form>
</div>
{%if ap%}
<script type="text/javascript">
	google.load('visualization', '1.0', {'packages':['corechart']});
	google.setOnLoadCallback(drawBandwidthChart);

	function drawBandwidthChart() {
		
		var data = google.visualization.arrayToDataTable([
		  ['Time', 'Rx Speed', 'Tx Speed'],
		  {%for log in apBandwidth%}
		  [new Date({{log.date.year}},{{log.date.month}}-1,{{log.date.day}},{{log.date.hour}},{{log.date.minute}},{{log.date.second}}), {{log.rx}}, {{log.tx}}],
		  {%endfor%}
		]);

		var options = {
		  title: 'Access Point Bandwidth (Mb/s)',
		  curveType : 'function',
		};

		var chart = new google.visualization.LineChart(document.getElementById('bandwidthchart_div'));
		chart.draw(data, options);
	}

	{%for i,logs in interfaceData.items%}
	google.setOnLoadCallback(drawInterface{{forloop.counter0}}Chart);
	function drawInterface{{i}}Chart() {
		
		var data = google.visualization.arrayToDataTable([
		  ['Time', 'Clients', 'Clients with Poor SNR', 'Channel Utilization'],
		  {%for log in logs%}
		  [new Date({{log.date.year}},{{log.date.month}}-1,{{log.date.day}},{{log.date.hour}},{{log.date.minute}},{{log.date.second}}), {{log.clients}}, {{log.poorSNR}} , {{log.channel}}/100],
		  {%endfor%}
		]);

		var options = {
			series: {2:{targetAxisIndex:1}},
			vAxes:[
				{}, 
				{title:'Channel Utilization',format: '#%'}
			],
			title: 'Occupancy',
		};

		var chart = new google.visualization.LineChart(document.getElementById('interface{{i}}chart_div'));
		chart.draw(data, options);
	}

	{%endfor%}

</script>

<h3>{{ap.name}}</h3>
<dl class="dl-horizontal">
	<dt>IP Address</dt>
	<dd>{{ap.ip}}</dd>	
	<dt>Mac Address</dt>
	<dd>{{ap.macAddress}}</dd>
	<dt>Ethernet Link</dt>
	<dd>{{ap.ethernetLinkSpeed}} Mb/s</dd>
</dl>
<div id="bandwidthchart_div" style="width: 900px; height: 500px;"></div>

{%for i,t in interfaceType.items%}
<h4>Interfaces {{i}} : <small>{{t}}</small> </h4>
<div id="interface{{i}}chart_div" style="width: 900px; height: 500px;"></div>
{%endfor%}


{%endif%}
{%endblock%}