% Chapter Template

\chapter{Analysis and Results} % Main chapter title

\label{Chapter6} % Change X to a consecutive number; for referencing this chapter elsewhere, use \ref{ChapterX}

\lhead{Chapter 6. \emph{Analysis and Results}} % Change X to a consecutive number; this is for the header on each page - perhaps a shortened title

\section{Analysis}
The final purpose of our system is to provide analysis on the main issues present on the infrastructure. The way we process here is quite straightforward.

\begin{enumerate}
\item Putting together the related information
\item Spotting the anomalies
\item Proposing adequate and possible fixes
\end{enumerate}
Like any system, we had to define domains on which the monitoring tool will have to work. One of the first steps of this thesis was to determine what were or could be the main issues on the UCL's network. It's here that we will use those. Each of these problems will be a domain in which we will define what are the relevant data, how they can help us and how to react after having analysed them. The purpose of this chapter is to present you these domains and the methodology used inside them. Each of them have their particular needs and their adequate treatments.

\section{Wifi}
\subsection{Users}
This section of the application offers some aggregated statistics about the users of the \emph{wifi network}. The main purpose is to get some analysis of the actual utilization of the wireless infrastructure. It's more a set of indicators to help the administrators to get a global view of his network. 
\subsubsection*{Wifi Protocol}
This graph display the repartition of the users among the available \texttt{802.11} standards (i.e. 802.11a, b, g, n). The reason for this analysis comes from an earlier policy enforced on the UCL network that forbids the use of the \texttt{802.11b} protocol. Users connecting with such low bandwidth standard force the \emph{access point} to transmitting longer and can in consequence prevent the others to achieve higher receiving speed. Our analyse was created to help the administrators in future considerations in the same domain. By profiling the habits of the users, we can define the impact of such decision. As the quality of the service is one of the main concern, deactivating the utilization of a standard used by most of the devices could have heavy consequences.
The statistics are based by default on the connections of the last three months. It's to ensure that devices no longer using the network doesn't affect the result and keep the analyse as up to date as possible.
\paragraph*{Source:} The data used come from \texttt{SNMP}. At each cycle gathering the information of the \emph{devices} associated with the \emph{access points}, we get the information thanks to the value available on the controller. All the descriptions of the OIB come from the Cisco OID Browser \footnote{http://tools.cisco.com/Support/SNMP/do/BrowseOID.do}.

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{bsnMobileStationProtocol} \\
\textbf{Description} & \parbox{11cm}{The 802.11 protocol type of the client. The protocol is mobile when this client detail is seen on the anchor i.e it's mobility status is anchor.} \\
\textbf{OID} & 1.3.6.1.4.1.14179.2.1.4.1.25 \\
\textbf{MIB} & AIRESPACE-WIRELESS-MIB \\
\hline
\end{tabular}

\subsubsection*{SSID Utilization}
Here, we count the number of users by \texttt{SSID}. As before, the goal is to provide a profile of the users to the administrators. Such measures can help to adapt the policies related to each \texttt{VLAN} and defining the load of each of them. It could help to diagnostic a useless \texttt{VLAN} or in the opposite, allow to detect an overloaded one that could be caused by an improper use of the network. The supposed utilization and the actual one can be really different and such indicators can help to adapt the configurations.
\paragraph*{Source:} As before, we mainly aggregate the data available on the controller.

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{bsnMobileStationSsid} \\
\textbf{Description} & \parbox{11cm}{The SSID Advertised by Mobile Station.} \\
\textbf{OID} & 1.3.6.1.4.1.14179.2.1.4.1.7 \\
\textbf{MIB} & AIRESPACE-WIRELESS-MIB \\
\hline
\end{tabular}

\subsection{Access Point}
This section group several analysis related to the \emph{access points}. In a network with several hundreds of \emph{access point}, it can be difficult to diagnostic and monitor each one of them. By centralising and aggregating the data, we allow the network managers to save time by automatising lot of computation. In this part of the application, we have access to the monitoring of each access point currently associated with the controller.
\subsubsection{Population}

\subsubsection*{Load}
A fundamental piece of information related to an \emph{access point} is the load. To achieve that we monitor each spot continuously and record its state several times per hour. By analysing these data, we are able to plot graph representing the load throughout the days. To achieve that, we need two information: the \textit{quantity} of data transiting in the link and the \textit{maximum speed} of the link. Concretely, each \texttt{AP} own two bytes counters that are incremented each time a byte is received or sent. The other information required is the link speed connecting the spot. This information alone can be useful to diagnostic bandwidth issues. In a big network, it can be difficult to keep track of which links were updated and which ones were not. By collecting these data, we found that some \emph{access point} were still connected to \texttt{10 Mbits} links. In this case, the main cause was that the concerned devices were not managed by the same service and in consequence were not updated with the others. % ????
This is the proof that even such simple data can help to diagnostic some inconsistency in the network.
\paragraph*{Source:} Here again, we use the data available on the controller. The first data collected are the bytes counter of each \emph{access points}.

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{cLApEthernetIfRxTotalBytes} \\
\textbf{Description} & \parbox{11cm}{This object represents total number of bytes in the error-free packets received on the interface.} \\
\textbf{OID} & 1.3.6.1.4.1.9.9.513.1.2.2.1.13 \\
\textbf{MIB} & CISCO-LWAPP-AP-MIB \\
\hline
\end{tabular}

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{cLApEthernetIfTxTotalBytes} \\
\textbf{Description} & \parbox{11cm}{This object represents total number of bytes in the error-free packets transmitted on the interface.} \\
\textbf{OID} & 1.3.6.1.4.1.9.9.513.1.2.2.1.14 \\
\textbf{MIB} & CISCO-LWAPP-AP-MIB \\
\hline
\end{tabular}

The next step is to obtain the speed of each link connected to an \emph{access point}. This time again we use the \texttt{SNMP} protocol to get the information from the controller.

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{cLApEthernetIfLinkSpeed} \\
\textbf{Description} & \parbox{11cm}{Speed of the interface in units of 1,000,000 bits per second.} \\
\textbf{OID} & 1.3.6.1.4.1.9.9.513.1.2.2.1.11 \\
\textbf{MIB} & CISCO-LWAPP-AP-MIB \\
\hline
\end{tabular}

\subsubsection*{Interfaces}
Each \emph{access point} has two wifi interfaces. The first one emits at \texttt{5Ghz} and the second on \texttt{2,4Ghz}. For each interface, the controller provides a lot of information completing the previous ones. The first that we gather is the \textit{number of users} currently associated to the interface. We compare these data with the quantity of users with a poor \texttt{Signal-Noise Ratio} (SNR). This analysis allows to diagnostic the efficiency of the access point. Even if it can be considered normal to have a couple of users in this category, if the proportion is constantly high, it can be an indicator that a supplementary \emph{access point} may be helpful or that the location of the AP is problematic. The problem have to be put in perspective with the statistics of the number of users and the RF environment (i.e \emph{Rogue Access Point} or physical walls) which is outside the scope of this system. 
Finally, we complete this analyse with a monitoring of the \emph{channel utilization}. A high utilization of the channel results in poor connection quality for the user and could indicates a poor RF condition.

\paragraph*{Source:} The controller keeps entries for each interface of each access point. We gather and cross all these data to generate some logs about each \emph{access point} and all the related \emph{interfaces}.

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{bsnAPIfLoadNumOfClients} \\
\textbf{Description} & \parbox{11cm}{This is the number of clients attached to this Airespace AP at the last measurement interval.} \\
\textbf{OID} & 1.3.6.1.4.1.14179.2.2.13.1.4 \\
\textbf{MIB} & AIRESPACE-WIRELESS-MIB \\
\hline
\end{tabular}

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{bsnAPIfPoorSNRClients} \\
\textbf{Description} & \parbox{11cm}{This is the number of clients with poor SNR attached to this Airespace AP at the last measurement interval.} \\
\textbf{OID} & 1.3.6.1.4.1.14179.2.2.13.1.24 \\
\textbf{MIB} & AIRESPACE-WIRELESS-MIB \\
\hline
\end{tabular}

\begin{tabular}{|r l|}
\hline
\textbf{Object} & \texttt{bsnAPIfLoadChannelUtilization} \\
\textbf{Description} & \parbox{11cm}{Channel Utilization.} \\
\textbf{OID} & 1.3.6.1.4.1.14179.2.2.13.1.3 \\
\textbf{MIB} & AIRESPACE-WIRELESS-MIB \\
\hline
\end{tabular}



\subsection{Rogue Access Points}

\subsection{Simulation of a user}
We use our \texttt{OpenWrt} routers as probes that simulate the behavior of a lamba user that connects to the university network. In order to do that, we have implemented a \texttt{C} program using \texttt{wpa\_supplicant} and its control interface. This program, launched by the router at boot, tries to establish a connection with each one of the five \texttt{VLANs} of the UCL (i.e. \texttt{student.UCLouvain}, \texttt{UCLouvain}, \texttt{visiteurs.UCLouvain}, \texttt{UCLouvain-prive} and \texttt{eduroam}). During that connection process we compute the time taken by \texttt{wpa\_supplicant} to get a connection and the time taken by \texttt{udhcpc} to get an IP address. Thanks to those information we can approximate the overall quality perceived by the normal users when they want to get an access to the Internet inside the UCL. Beside that, our program also checks if a selection of the most used services by a user are reachable with each of the \texttt{VLANs}. We have decided to check the reachability of the following services:
\begin{itemize}
	\item[-] \texttt{www.google.be}
	\item[-] \texttt{www.smtp.gmail.com}
	\item[-] \texttt{www.github.com}
	\item[-] \texttt{www.uclouvain.be}
	\item[-] \texttt{www.icampus.uclouvain.be}
\end{itemize}

We add these additional information to the log file our program creates and sends to our server for parsing and analysis.

\subsubsection*{Choice of the Access Point}
The first thing our program does when it starts its connection loop is to perform a scan of the networks available where the probe is placed and to write the results inside the log file. Among the results and for each network we have decided to keep the network \texttt{BSSID}, the \texttt{Signal Strength} of the network and its \texttt{SSID}. Those data are interesting for our analysis. Indeed, when the router tries to get a connection, it first tries to associate with an Access Point. But there could be several APs in the area and he might be rejected from one or several of them. If its association request is rejected by one AP, \texttt{wpa\_supplicant} will try to associate with another one, and so on until the request is accepted. Our program gathers all the \texttt{BSSID} of the APs it had an association request with. 
Comparing the scan results for each AP and the APs tried and the one it has a connection with is quite interesting. Indeed, after having performed several tests, we have observed that the device does not always connect to the best AP (i.e. the one with the best signal strength).

One explaination for that is that in its choosing process, %https://chromium-review.googlesource.com/#/c/183720/

\section{Controller}

\subsection{Components Activity}

\section{DHCP}
These analyses aim to detect \emph{DHCP} related issues. The allocation  of IP addresses is a fundamentals component in our network. Being able to detect when problems appears and advertise them could help to make a quicker and more efficient response.

\subsection{Leases}
The main problem with a DHCP is the allocation of ranges of addresses. It's always difficult to determine the quantity of required IP by VLAN. Moreover, when such problems arise, it can be hard to be aware of them. Most of the time, users don't report the problem and when they do, their descriptions state only that they can't connect which is not very useful. Being able to automatically detect a lack of IP addresses can be very time saving for any administrators. Even is such information are available in the \emph{DHCP} logs and that the servers could send warnings, centralising these information aside data related to all the other components of the infrastructure can lead to more powerful analysis. 

\subsection{Crash}


\section{Radius}

\subsection{Authentication Success Rate}




